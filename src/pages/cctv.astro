---
import Layout from "../layouts/Layout.astro";
import "@fontsource/dela-gothic-one";
---

<Layout title="VIC Seguridad - CCTV.">
        <main
                class="min-h-screen text-white bg-gradient-to-b from-[#0D1A28] to-[#0d1b2ac9] snap-y snap-mandatory"
        >
                <h1
                        class="text-3xl sm:text-5xl 2xl:text-6xl text-center sm:pt-48 pt-32 px-4"
                >
                        Cámaras de seguridad CCTV
                </h1>

                <section
                        class="relative w-full flex flex-row items-center justify-between h-[55vh] gap-10 md:px-20 px-6 mt-16 bg-[url(/images/services/cctv/camara.jpg)] sm:bg-none bg-cover bg-center sm:bg-[white]"
                >
                        <div class="sm:hidden absolute inset-0 bg-black/70">
                        </div>

                        <div
                                class="flex flex-col items-center sm:text-[#13171C] sm:text-left text-justify z-20"
                        >
                                <h1
                                        class="2xl:text-4xl text-2xl text-bold py-4 w-full text-left"
                                >
                                        <strong>
                                                No pierdas de vista lo que más
                                                te importa.
                                        </strong>
                                </h1>

                                <p class="m-5 mt-0 py-3 2xl:text-2xl w-full">
                                        Instalamos sistemas de circuito cerrado
                                        de televisión (CCTV) análogos HD e IP
                                        Full HD de alta resolución, adaptados a
                                        espacios interiores y exteriores según
                                        tus necesidades. Ya sea para proteger tu
                                        negocio o reforzar la seguridad de tu
                                        hogar y familia, en <strong
                                                >VIC Seguridad</strong
                                        > estamos comprometidos con tu tranquilidad.
                                        Consultanos y descubre cómo podemos ayudarte
                                        a estar más seguro.
                                </p>

                                <div class="flex flex-col sm:flex-row sm:gap-12 gap-4">
                                        <a class="sm:mb-8" href="/contacto">
                                                <button
                                                        class="xl:text-lg justify-center text-center border-2 sm:border-[#13171C] shadow-lg rounded-lg p-2 sm:hover:bg-[#0D1A28] sm:hover:text-white hover:bg-[white] hover:text-[#13171C] transition-all"
                                                >
                                                        Consulta por el servicio
                                                </button>
                                        </a>
                                        <a class="mb-8" href="#cotiza-cctv">
                                                <button
                                                        class="xl:text-lg justify-center text-center border-2 sm:border-[#13171C] shadow-lg rounded-lg  p-2 sm:hover:bg-[#0D1A28] sm:hover:text-white hover:bg-[white] hover:text-[#13171C] transition-all min-w-[204px]"
                                                >
                                                        Cotiza tu instalación
                                                </button>
                                        </a>
                                </div>
                        </div>

                        <div
                                class="h-full items-center overflow-clip sm:flex hidden"
                        >
                                <img
                                        class="w-[150vw]"
                                        src="/images/services/cctv/camara.jpg"
                                        alt=""
                                />
                        </div>
                </section>

                <span
                        class="flex flex-col items-center text-center sm:mt-28 mt-14 sm:mb-14"
                >
                        <h1
                                class="text-2xl/tight sm:text-4xl/tight 2xl:text-6xl/tight"
                        >
                                Todo lo que necesitas saber <br /> sobre nuestras
                                cámaras de seguridad
                        </h1>
                </span>

                <section
                        class="w-full flex md:flex-row flex-col md:px-40 px-10 pt-14 mb-28 text-pretty md:justify-between justify-center items-center gap-10"
                >
                        <button
                                id="bubble1"
                                class="relative md:w-[23vw] sm:w-[50vw] w-[70vw] aspect-square bg-[url(/images/services/cctv/monitoreo.jpg)] bg-cover bg-center rounded-full content-center text-center 2xl:text-6xl text-3xl transition-all duration-500 hover:scale-110 hover:shadow-xl hover:shadow-slate-400"
                        >
                                <span id="titulo" class="block">
                                        <div
                                                class="absolute inset-0 bg-black/50 transition rounded-full"
                                        >
                                        </div>
                                        <div
                                                class="relative select-none pointer-events-none justify-center flex flex-col h-full"
                                        >
                                                <h2>¿Qué es?</h2>
                                        </div>
                                </span>
                                <span id="info" class="hidden">
                                        <div
                                                class="absolute inset-0 bg-black/70 transition rounded-full"
                                        >
                                        </div>
                                        <div
                                                class="relative select-none pointer-events-none items-center max-h-full px-10 overflow-clip"
                                        >
                                                <p
                                                        class="2xl:text-3xl md:text-xl text-lg text-wrap font-semibold"
                                                        style="transform: rotateY(180deg);"
                                                >
                                                        CCTV (Circuito Cerrado
                                                        de Televisión) es un
                                                        sistema de <span
                                                                class="text-blue-500 text-bold"
                                                                >cámaras</span
                                                        > conectadas que permite
                                                        <span
                                                                class="text-blue-500 text-bold"
                                                                >monitorear</span
                                                        > y <span
                                                                class="text-blue-500 text-bold"
                                                                >grabar</span
                                                        > espacios en tiempo real.
                                                </p>
                                        </div>
                                </span>
                        </button>

                        <button
                                id="bubble2"
                                class="relative md:w-[23vw] sm:w-[50vw] w-[70vw] aspect-square bg-[url(/images/services/cctv/robo.jpg)] bg-cover rounded-full content-center text-center 2xl:text-6xl text-3xl transition-all duration-500 hover:scale-110 hover:shadow-xl hover:shadow-slate-400"
                        >
                                <span id="titulo2" class="block">
                                        <div
                                                class="absolute inset-0 bg-black/50 transition rounded-full"
                                        >
                                        </div>
                                        <div
                                                class="relative select-none pointer-events-none justify-center flex flex-col h-full"
                                        >
                                                <h2>Utilidad</h2>
                                        </div>
                                </span>
                                <span id="info2" class="hidden">
                                        <div
                                                class="absolute inset-0 bg-black/70 transition rounded-full"
                                        >
                                        </div>
                                        <div
                                                class="relative select-none pointer-events-none max-h-full px-10 overflow-clip"
                                        >
                                                <p
                                                        class="2xl:text-3xl md:text-xl text-lg font-semibold mx-4"
                                                        style="transform: rotateY(180deg);"
                                                >
                                                        Ideal para <span
                                                                class="text-blue-500"
                                                                >vigilar</span
                                                        >, <span
                                                                class="text-blue-500"
                                                                >prevenir robos</span
                                                        > y <span
                                                                class="text-blue-500"
                                                                >controlar
                                                                accesos</span
                                                        >, mejorando la
                                                        seguridad de hogares,
                                                        negocios y espacios
                                                        públicos.
                                                </p>
                                        </div>
                                </span>
                        </button>

                        <button
                                id="bubble3"
                                class="relative md:w-[23vw] sm:w-[50vw] w-[70vw] aspect-square bg-[url(/images/services/cctv/monitoreo-movil.jpg)] bg-cover bg-center rounded-full content-center text-center 2xl:text-6xl text-3xl transition-all duration-500 hover:scale-110 hover:shadow-xl hover:shadow-slate-400"
                        >
                                <span id="titulo3" class="block">
                                        <div
                                                class="absolute inset-0 bg-black/60 transition rounded-full"
                                        >
                                        </div>
                                        <div
                                                class="relative select-none pointer-events-none justify-center flex flex-col overflow-clip"
                                        >
                                                <h2>Beneficios</h2>
                                        </div>
                                </span>
                                <span id="info3" class="hidden">
                                        <div
                                                class="absolute inset-0 bg-black/80 transition rounded-full"
                                        >
                                        </div>
                                        <div
                                                class="relative select-none pointer-events-none max-h-full px-10 overflow-clip"
                                        >
                                                <p
                                                        class="2xl:text-3xl md:text-xl text-lg font-semibold mx-4"
                                                        style="transform: rotateY(180deg);"
                                                >
                                                        <span
                                                                class="text-blue-500"
                                                                >Disuasión del
                                                                delito</span
                                                        >, evidencia en video, <span
                                                                class="text-blue-500"
                                                                >monitoreo
                                                                remoto</span
                                                        > y mayor tranquilidad las
                                                        24 horas desde tu propio
                                                        <span
                                                                class="text-blue-500"
                                                                >dispositivo
                                                                movil</span
                                                        >.
                                                </p>
                                        </div>
                                </span>
                        </button>
                </section>

                <section
                        id="cotiza-cctv"
                        class="bg-white py-20 px-6 sm:px-12 text-black"
                >
                        <div
                                class="max-w-4xl mx-auto bg-gray-100 sm:p-8 p-4 rounded-lg shadow-lg"
                        >
                                <h1
                                        class="md:text-4xl text-2xl font-semibold mb-10"
                                >
                                        Cotiza tu instalación de cámaras CCTV
                                </h1>
                                <p class="text-lg mb-6 font-medium">
                                        Selecciona cuántas cámaras deseas
                                        instalar y obtén una estimación del
                                        costo total.
                                </p>

                                <div
                                        class="flex flex-col sm:flex-row items-center gap-4"
                                >
                                        <label for="camQty" class="font-medium"
                                                >Cantidad de cámaras:</label
                                        >
                                        <input
                                                id="camQty"
                                                type="number"
                                                min="1"
                                                max="32"
                                                value="1"
                                                class="border border-gray-300 rounded px-4 py-2 w-24"
                                        />
                                </div>

                                <p class="mt-6">
                                        Si necesitas instalar más de 32 cámaras,
                                        comunicate con nosotros por cualquiera
                                        de <a
                                                class="underline underline-offset-2 text-blue-800 hover:text-blue-500"
                                                href="/contacto"
                                                >nuéstros medios.</a
                                        >
                                </p>

                                <div
                                        class="flex justify-center items-center gap-4 mt-6"
                                >
                                        <div
                                                class="bg-white p-4 rounded w-full"
                                        >
                                                <p
                                                        class="text-lg font-semibold"
                                                >
                                                        Costo estimado:
                                                </p>
                                                <p
                                                        id="cotizacionTotal"
                                                        class="text-2xl font-bold text-blue-600"
                                                >
                                                        $0
                                                </p>
                                        </div>

                                        <h1
                                                class="min-w-fit sm:text-xl text-lg font-bold"
                                        >
                                                + IVA
                                        </h1>
                                </div>

                                <p class="mt-2">
                                        Valor referencial sujeto a evaluación en
                                        visita técnica
                                </p>

                                <div class="w-full mt-6 flex justify-center">
                                        <button id="pagarBtn" class=" bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition duration-300">
                                                Ir a pagar
                                        </button>
                                </div>
                        </div>
                </section>
        </main>
</Layout>

<style>
        h2 {
                font-family: "Dela Gothic One", system-ui;
        }
</style>

<script>
        // Aqui debe ir el script que agrega el efecto animate-rotate-left y animate-rotate-right a los elementos de la pagina luego de hacerles click a las cards de los servicios.
        function setupBubbleToggle(bubbleId, titleId, infoId) {
                const bubble = document.getElementById(bubbleId);
                const title = document.getElementById(titleId);
                const info = document.getElementById(infoId);

                bubble?.addEventListener("click", () => {
                        const isActive =
                                bubble.classList.contains(
                                        "animate-flip-horizontal",
                                ) &&
                                title?.classList.contains("animate-fade-out");

                        if (isActive) {
                                bubble.classList.remove(
                                        "animate-flip-horizontal",
                                );
                                title?.classList.remove(
                                        "animate-fade-out",
                                        "hidden",
                                );
                                info?.classList.remove("animate-fade-in");
                                info?.classList.add("hidden");
                        } else {
                                bubble.classList.add("animate-flip-horizontal");
                                title?.classList.add("animate-fade-out");

                                setTimeout(() => {
                                        title?.classList.add("hidden");
                                }, 250);
                                setTimeout(() => {
                                        info?.classList.add("animate-fade-in");
                                        info?.classList.remove("hidden");
                                }, 500);
                        }

                        console.log(`click en ${bubbleId}`);
                });
        }

        // Se aplica a todas las burbujas
        setupBubbleToggle("bubble1", "titulo", "info");
        setupBubbleToggle("bubble2", "titulo2", "info2");
        setupBubbleToggle("bubble3", "titulo3", "info3");
        // Fin del script que agrega el efecto animate-rotate-left y animate-rotate-right a los elementos de la pagina luego de hacerles click a las cards de los servicios.

        const camQtyInput = document.getElementById("camQty");
        const cotizacionTotal = document.getElementById("cotizacionTotal");

        
        const precioCamaraExtra = 80000; // por cámara adicional

        function calcularCosto() {
                const cantidad =
                        parseInt((camQtyInput as HTMLInputElement).value, 10) ||
                        0;

                // Pack base según cantidad
                let packPrecio = 0;
                let packIncluyeCamaras = 1;

                if (cantidad <= 0) {
                        if (cotizacionTotal)
                        cotizacionTotal.textContent = "$0";
                        return;
                } else if (cantidad <= 4) {
                        packPrecio = 350000;
                } else if (cantidad <= 8) {
                        packPrecio = 450000;
                } else if (cantidad <= 16) {
                        packPrecio = 550000;
                } else if (cantidad <= 32) {
                        packPrecio = 650000;
                } else {
                        // Para más de 32 cámaras, no hay pack definido
                        if (cotizacionTotal)
                        cotizacionTotal.textContent =
                                "Contáctanos para una cotización personalizada";
                        return;
                }

                // Calcular cámaras extra
                const camarasExtra = Math.max(0, cantidad - packIncluyeCamaras);
                const total = packPrecio + camarasExtra * precioCamaraExtra;

                // Mostrar el resultado
                const totalFormateado = new Intl.NumberFormat("es-CL", {
                        style: "currency",
                        currency: "CLP",
                }).format(total);

                if (cotizacionTotal)
                cotizacionTotal.textContent = totalFormateado;
        }

        
        camQtyInput?.addEventListener("input", calcularCosto);
        calcularCosto(); 

</script>

<script type="module">
  document.getElementById("pagarBtn").addEventListener("click", async () => {
        
         const amount = parseFloat(document.getElementById("cotizacionTotal").textContent.replace(/\./g, "").replace("$", ""));
        
         if (amount <= 0) {
             alert("Por favor, selecciona una cantidad válida de cámaras.");
             return;
        }
        

    try {
      const res = await fetch("/api/pagar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          amount: amount, 
        }),
      });

      const data = await res.json();
      if (res.ok) {
        window.location.href = `${data.url}?token_ws=${data.token}`;
      } else {
        console.error("Error en el pago:", data);
        alert(`Error: ${data.error || "Error al generar transacción"}`);
        window.location.reload();
      }
    } catch (err) {
      console.error("Error en la solicitud:", err);
      alert("Error al procesar el pago. Intenta nuevamente.");
      window.location.reload();
    }
  });
</script>


